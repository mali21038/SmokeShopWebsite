{% extends "base.html" %}

{% block extra_css %}
<style>
    .admin-sidebar {
        background: linear-gradient(135deg, var(--dark-brown), var(--primary-color));
        min-height: calc(100vh - 76px);
        color: var(--cream);
    }
    
    .admin-sidebar .nav-link {
        color: var(--cream);
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.25rem;
        transition: all 0.3s ease;
    }
    
    .admin-sidebar .nav-link:hover,
    .admin-sidebar .nav-link.active {
        background: rgba(255, 255, 255, 0.1);
        color: var(--gold);
    }
    
    .admin-content {
        background: #f8f9fa;
        min-height: calc(100vh - 76px);
        padding: 2rem;
    }
    
    .form-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
    }
    
    .image-upload-area {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .image-upload-area:hover {
        border-color: var(--primary-color);
        background: rgba(139, 69, 19, 0.05);
    }
    
    .image-upload-area.dragover {
        border-color: var(--primary-color);
        background: rgba(139, 69, 19, 0.1);
    }
    
    .preview-image {
        max-width: 200px;
        max-height: 200px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0">
        <!-- Admin Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="admin-sidebar p-3">
                <div class="mb-4">
                    <h5 class="text-center">
                        <i class="fas fa-user-shield me-2"></i>Admin Panel
                    </h5>
                    <hr class="border-light">
                </div>
                
                <nav class="nav flex-column">
                    <a class="nav-link" href="{{ url_for('admin.dashboard') }}">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    <a class="nav-link active" href="{{ url_for('admin.products') }}">
                        <i class="fas fa-box me-2"></i>Products
                    </a>
                    <a class="nav-link" href="{{ url_for('admin.categories') }}">
                        <i class="fas fa-tags me-2"></i>Categories
                    </a>
                    <a class="nav-link" href="{{ url_for('admin.orders') }}">
                        <i class="fas fa-shopping-cart me-2"></i>Orders
                    </a>
                    <a class="nav-link" href="{{ url_for('admin.customers') }}">
                        <i class="fas fa-users me-2"></i>Customers
                    </a>
                    <hr class="border-light">
                    <a class="nav-link" href="{{ url_for('customer.home') }}">
                        <i class="fas fa-store me-2"></i>View Store
                    </a>
                    <a class="nav-link" href="{{ url_for('auth.logout') }}">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                </nav>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="admin-content">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="fw-bold mb-1">Add New Product</h2>
                        <p class="text-muted mb-0">Create a new product for your store</p>
                    </div>
                    <div>
                        <a href="{{ url_for('admin.products') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Products
                        </a>
                    </div>
                </div>
                
                <!-- Add Product Form -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card form-card">
                            <div class="card-header bg-white border-0 py-3">
                                <h5 class="fw-bold mb-0">Product Information</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" enctype="multipart/form-data">
                                    <div class="row">
                                        <div class="col-md-8 mb-3">
                                            <label for="name" class="form-label">Product Name *</label>
                                            <input type="text" class="form-control" id="name" name="name" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="brand" class="form-label">Brand</label>
                                            <input type="text" class="form-control" id="brand" name="brand">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="description" class="form-label">Description</label>
                                        <textarea class="form-control" id="description" name="description" rows="4" 
                                                  placeholder="Enter product description..."></textarea>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="price" class="form-label">Price ($) *</label>
                                            <input type="number" class="form-control" id="price" name="price" 
                                                   step="0.01" min="0" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="stock_quantity" class="form-label">Stock Quantity *</label>
                                            <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" 
                                                   min="0" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="category_id" class="form-label">Category *</label>
                                            <select class="form-select" id="category_id" name="category_id" required>
                                                <option value="">Select Category</option>
                                                {% for category in categories %}
                                                <option value="{{ category.id }}">{{ category.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                                                <label class="form-check-label" for="is_featured">
                                                    Featured Product
                                                </label>
                                                <div class="form-text">Featured products appear on the homepage</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
                                                <label class="form-check-label" for="is_active">
                                                    Active Product
                                                </label>
                                                <div class="form-text">Only active products are visible to customers</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex gap-3 mt-4">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>Save Product
                                        </button>
                                        <a href="{{ url_for('admin.products') }}" class="btn btn-outline-secondary">
                                            Cancel
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Image Upload -->
                        <div class="card form-card mb-4">
                            <div class="card-header bg-white border-0 py-3">
                                <h5 class="fw-bold mb-0">Product Image</h5>
                            </div>
                            <div class="card-body">
                                <div class="image-upload-area" id="imageUploadArea">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h6>Upload Product Image</h6>
                                    <p class="text-muted mb-3">Drag and drop an image here, or click to select</p>
                                    <input type="file" id="imageInput" name="image" accept="image/*" style="display: none;">
                                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('imageInput').click()">
                                        Choose File
                                    </button>
                                </div>
                                <div id="imagePreview" class="mt-3 text-center" style="display: none;">
                                    <img id="previewImg" class="preview-image" alt="Preview">
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeImage()">
                                            <i class="fas fa-trash me-1"></i>Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tips -->
                        <div class="card form-card">
                            <div class="card-header bg-white border-0 py-3">
                                <h5 class="fw-bold mb-0">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>Tips
                                </h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Use high-quality images (at least 800x800px)
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Write detailed product descriptions
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Set competitive pricing
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Keep stock quantities updated
                                    </li>
                                    <li class="mb-0">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Use featured products to highlight bestsellers
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Image upload functionality
const imageUploadArea = document.getElementById('imageUploadArea');
const imageInput = document.getElementById('imageInput');
const imagePreview = document.getElementById('imagePreview');
const previewImg = document.getElementById('previewImg');

// Click to upload
imageUploadArea.addEventListener('click', () => {
    imageInput.click();
});

// Drag and drop
imageUploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    imageUploadArea.classList.add('dragover');
});

imageUploadArea.addEventListener('dragleave', () => {
    imageUploadArea.classList.remove('dragover');
});

imageUploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    imageUploadArea.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleImageFile(files[0]);
    }
});

// File input change
imageInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        handleImageFile(e.target.files[0]);
    }
});

function handleImageFile(file) {
    if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        return;
    }
    
    if (file.size > 5 * 1024 * 1024) { // 5MB limit
        alert('Image size should be less than 5MB');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        previewImg.src = e.target.result;
        imagePreview.style.display = 'block';
        imageUploadArea.style.display = 'none';
    };
    reader.readAsDataURL(file);
}

function removeImage() {
    imageInput.value = '';
    imagePreview.style.display = 'none';
    imageUploadArea.style.display = 'block';
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const price = document.getElementById('price').value;
    const stock = document.getElementById('stock_quantity').value;
    const category = document.getElementById('category_id').value;
    
    if (!name || !price || !stock || !category) {
        e.preventDefault();
        alert('Please fill in all required fields');
        return;
    }
    
    if (parseFloat(price) <= 0) {
        e.preventDefault();
        alert('Price must be greater than 0');
        return;
    }
    
    if (parseInt(stock) < 0) {
        e.preventDefault();
        alert('Stock quantity cannot be negative');
        return;
    }
});
</script>
{% endblock %}

